%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% AMS uses the snapshot package to track which versions of other 
%     packages are being loaded to ensure consistent compiles. 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{snapshot}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% We expect most lecture notes will use sections and subsections (and 
%     possibly subsubsections). For those that do all numbering will
%     be of the form section.subsection.counter use the equation
%     as the counter and resetting it with each subsection. If so,
%     please leave the lines below as is.
%
% To support any authors who wish to divide their notes only into  
%     sections, or who prefer to use only unnumbered subsections via
%     \subsection*, the following lines offer the option to do all 
%     numbering in the form section.counter (again using the 
%     equation counter) resetting with each section. 
%     option which avoids having a subsection number of 0 everywhere
%     please comment out the line \subsectionsfalse below and then
%     comment out the line \subsectionstrue.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newif\ifsubsections
% Uncomment this line and comment out the line below it if you use 
%     numbered subsections in your notes. 
%\subsectionstrue 
% Uncomment this line and comment out the line above if you do not use 
%     numbered subsections in your notes. 
%\subsectionsfalse

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Load the standard PCMI lecture notes class file. 
%     Please do not insert options to the class file to maintain
%     consistency between the files of all authors.
%
% Note that the class file requires (and so loads) the following 
%     packages in setting up the design of the PCMI lecture pages:
%         float (provides support for better positioning of floats)
%         setspace (provides support for adjustment of leading [spacing] of text)
%         titlesec (provides support for sectioning commands and appearnace of toc)
%     No need to load these packages if you wish to use them.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[]{pcmi}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Load standard packages to set up the fonts used in the PCMI lectures
%     and provide standard support for color and graphics files.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Fonts: the PCMI volumes will use 
%      Palladino as the text family, a smaller Bera for sans
%      Euler for math characters and Incolsolata for tt
%      Incolsolata for for a fixed width "typewriter" font
%      Bera if a sans serif family is required
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[sc]{mathpazo}          % Palatino with smallcaps as text font
\usepackage{eulervm}               % Euler math
\usepackage[scaled=0.86]{berasans} % Bera for san serif family
\usepackage[scaled=1]{inconsolata} % Inconsolata for fixed width
\usepackage[T1]{fontenc}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% We use only those microtype features supported by both pdftex and dvips
%     (cf. Table 1 on p.7 of the microtype documentation). 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[%
	protrusion=true,
	expansion=false,
	auto=false
	]{microtype}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Support for color and inclusion of graphics through xcolor and graphicx
%
%     Please place any included graphics in a directory named "figures" 
%     in the same directory as your LaTeX source file. You can then include 
%     the file "circle.eps" from this folder by issuing the command
%
%         \includegraphics[]{circle.eps}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{xcolor}
\usepackage{graphicx}
\graphicspath{{./figures/}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Define colors for internal and external links for use by authors
%     if in draft mode (\drafttrue) and as black for final printing
%     (draftfalse).
%
% Authors please imitate this model. If you want to use any colored text
%     give your color a name and then use the ifdraft switch to set this
%     name to your color for \drafttrue and also to black for \draftfalse.
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifdraft
	\definecolor{linkred}{rgb}{0.7,0.2,0.2}
	\definecolor{linkblue}{rgb}{0,0.2,0.6}
\else
	\definecolor{linkred}{rgb}{0.0,0.0,0.0}
	\definecolor{linkblue}{rgb}{0,0.0,0.0}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Authors: please load ALL packages you use that are not in the lists 
%      above or below (where we have packages that need to be loaded 
%      "late") at this point.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Authors: load additional packages here

%\usepackage{pstricks,pst-plot,pst-node}


\usepackage{amssymb,amsfonts,amsthm}
%\usepackage{amsmath}
\usepackage[makeroom]{cancel}
\usepackage{mathtools}
%\usepackage{yfonts}
%\usepackage{mathrsfs,pifont}
\usepackage{pifont}% AO: removed mathrsfs as the script it uses clashes with the Euler math used here and replaced it with eucal
\usepackage[mathscr]{eucal}
\usepackage{slashed,mathabx} 
\usepackage[bbgreekl]{mathbbol}
\usepackage{tikz-cd}
\usepackage{enumitem}
\usepackage{quiver}
\usepackage[all]{xy}
\usepackage{mathrsfs}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Load hyperref and amsrefs packages: these MUST be the last packages 
%     loaded or problems are very likely to result so please keep
%     them in this position.
%
% Please do not alter any of the options given here to maintain
%     consistency between authors and with the AMS production
%     requirements. 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\PassOptionsToPackage{hyphens}{url} 
\usepackage[
    setpagesize=false,
    pagebackref,
	pdfpagelabels=false,
    pdfstartview={FitH 1000},
    bookmarksnumbered=false,
    linktoc=all,
    colorlinks=true,
    anchorcolor=black,
    menucolor=black,
    runcolor=black,
    filecolor=black,
    linkcolor=linkblue,%IM black if not in draft mode
	citecolor=linkblue,%IM black if not in draft mode
	urlcolor=linkred,%IM black if not in draft mode
]{hyperref}%IM
\usepackage[backrefs,msc-links,nobysame]{amsrefs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Adjust aspects of formatting of references by amsrefs to match our style
%         
%     In particular this provides two macros for use in the eprints
%         field of a bib entry
%
%     For pointers to arXiv preprints, simply use the arXiv citation key
%         which is the numerical filename of the article abstract (found
%         at the end of the URL for the abstract). Thus to reference
%         http://arxiv.org/abs/1503.05174 simply insert \bibarxiv{1503.05174}.
%         in the eprint field which would thus read
%             \eprint={\bibarxiv{1503.05174}},
%
%     For pointers to preprints at other URLs, give the the full URL.
%         as an argument to the macro \biburl. Thus to point to
%             http://www.ugr.es/~jperez/papers/finite-top-sept29.pdf
%         insert \biburl{http://www.ugr.es/~jperez/papers/finite-top-sept29.pdf}
%         in the eprint field which would thus read
%             \eprint={\biburl{http://www.ugr.es/~jperez/papers/finite-top-sept29.pdf}.},
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\customizeamsrefs 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Please load NO packages after  this point. Problems with hyperref or 
%         amsrefs are likely to result if you do. 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \newtheorems and other numbered elements
%
%     Use the area below to define your own \newtheorems using your preferred 
%         aliases.
%
%     To ensure that your environments share the PCMI standard system for autonumbering:
%         Use only the standard \theoremstyles plain, definition and remark and 
%             avoid altering the formatting of these styles to ensure uniformity.
%   
%         Please tie all your \newtheorems to the equation counter by inserting 
%             "[equation]" between the alias and the printed name of the 
%             environement as in the examples below.
%
%         Please do NOT change the formatting of the equation counter. 
%
%     In order for floats such as Tables and Figures to number and 
%         reference correctly, please make sure that your \label
%         command is placed with AFTER or INSIDE the float caption.
%
%     This ensures that the label uses the counter value
%          at the time the float is placed on a page which may be 
%          different from the counter's value when the float was read 
%          becuase the float has been moved forward or back.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Authors: define your theoremlike environments here

\theoremstyle{plain}
\newtheorem{Proposition}[equation]{Proposition}
\newtheorem{Lemma}[equation]{Lemma}
\newtheorem{Corollary}[equation]{Corollary}
\newtheorem{Theorem}[equation]{Theorem}
\newtheorem{Fact}[equation]{Fact}


\theoremstyle{definition}
\newtheorem{Definition}[equation]{Definition}
\newtheorem{Exercise}[subsubsection]{Exercise}
\newtheorem{Example}[equation]{Example}

\theoremstyle{remark}
\newtheorem{Remark}[equation]{Remark}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Macros
%     At this point, place the roster of 'personal' macros you use 
%         in writing up your lectures and other LaTeX files.
%
%     The two macros below are provided as examples. In this file
%         the macro \replace indicates a field (like a name or 
%         address) in which you need to replace a placeholder value  
%         provided here with the corresponding value for you or your lectures.
%
%     You can verify that you have made all the intended replacements
%         by simply deleting this macro and checking that no errors result. 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Authors: insert your personal TeX macros here

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Override numbering in the class file to allow use of numbered 
%     subsubsections (which are often \ref'd here)
% Redefine the \subsubsection command to force the associated    
%     counter to synch with the equation counter before the
%     subsubsection is declared and then afterwards
%     increment the equation counter thus forcing the use of
%     successive values for all numbered elements
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{macros}
\setcounter{tocdepth}{2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Start of document body
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Filling in title page, running head and author fields.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title[Algebraic Geometry]{[Hartshorne] Algebraic Geometry} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    
%    Author information--add further authors as needed
%    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\author{Alan Yan}
\date{} 
\address{
\newline Department of Mathematics,
Harvard University,
Cambridge, MA 02138 
}
\email{	alanyan@math.harvard.edu}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    
%    Classification and abstract
%    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\keywords{}
\begin{abstract}
    \textcolor{red}{To be added.}
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    
%    Make the title page
%    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\maketitle

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    
%    Your lecture notes replace the remainder of this document.
%    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Authors: insert the body of your lectures here


\section{Introduction} 

This document contains my solutions to the exercises in~\cite{Harts77}. 
\section{Chapter 1: Varieties}

\section{Chapter 2: Schemes}

\subsection{Sheaves}

\subsection{Schemes}


\begin{Exercise}
    Let $A$ be a ring, let $X = \Spec A$, let $f \in A$ and let $D(f) \subseteq X$ be the open complement of $V((f))$. Show that the locally ringed space $(D(f), \cO_X|_{D(f)})$ is isomorphic to $\Spec A_f$. 
\end{Exercise}

\begin{proof}
    The localization map $\ell : A \to A_f$ induces a bijection between ideals of $A$ not containing $f$ and the ideals of $A_f$. This bijection gives a one-to-one correspondence between the prime ideals of $A$ not containing $f$ and the prime ideals of $A_f$. In other words, we have a bijection $\varphi : D(f) \to \Spec A_f$. For any ideal $\fa$ of $A$ not containing $f$, we have $\fp \supseteq \fa$ if and only if $\varphi(\fp) \supseteq \varphi(\fa)$. This proves that $\varphi$ is a homeomorphism. An isomorphism on the sheaf structure is induced by the natural isomorphism 
    \[
        \left( A_f \right)_{\varphi(\fp)} \to A_\fp. 
    \]
\end{proof}

\begin{Exercise}
    Let $(X, \cO_X)$ be a scheme, and let $U \subseteq X$ be any open subset. Show that $\left (U, \cO_X|_U \right )$ is a scheme. We call this the \textbf{induced scheme structure} on the open set $U$, and we refer to $\left( U, \cO_X|_U \right)$ as an open subscheme of $X$. 
\end{Exercise}

\begin{proof}
    It suffices to assume $X$ is affine. In this case, the distinguished open sets are affine schemes. Since this forms a basis of the topology, this implies that an open set inherits a scheme structure. 
\end{proof}

\begin{Exercise}[Reduced schemes]
    A scheme $(X, \cO_X)$ is \textbf{reduced} if for every open set $U \subseteq X$, the ring $\cO_X(U)$ has no nilpotent elements. 
    \begin{enumerate}[label = (\alph*)]
        \item Show that $(X, \cO_X)$ is reduced if and only if for every $p \in X$, the local ring $\cO_{X, p}$ has no nilpotent elements. 
        \item Let $(X, \cO_X)$ be a scheme. Let $\left (\cO_X \right )_{\red}$ be the sheaf associated to the presheaf $U \mapsto \cO_X(U)_{\red}$, where for any ring $A$, we denote by $A_{\red}$ the quotient of $A$ by its ideal of nilpotent elements. Show that $ \left (X, \left ( \cO_X \right )_{\red} \right )$ is a scheme. We call it the \textbf{reduced scheme} of $X$ and denote it $X_{\red}$. Show that there is a morphism of schemes $X_{\red} \to X$ which is a homeomorphism on the underlying topological spaces. 
        \item Let $f : X \to Y$ be a morphism of schemes, and assume that $X$ is reduced. Show that there is a unique morphism $g : X \to Y_{\red}$ such that $f$ is obtained by composing $g$ with the natural map $Y_{\red} \to Y$. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    Suppose that $\cO_{X, p}$ has no nilpotent elements for all $p \in U$. Let $s \in \cO_X(U)$ be nilpotent. Then the germ of $s$ at every $p \in U$ must be zero. From the identity axiom, this implies that $s = 0$. Hence $\cO_X(U)$ has no nilpotents. Conversely, suppose that $\cO_X(U)$ has no nilpotents for all open $U \subseteq X$. Let $(U, \cO_X|_U) \simeq \Spec A$ be an affine open containing $p \in X$ and let $p$ corresponding to the prime ideal $\fp$ in $\Spec A$. Then $\cO_{X, p} \simeq A_\fp$. From our hypothesis $A$ is reduced. This implies that $A_\fp$ is reduced which completes the proof to Part (a). 

    
    To construct a morphism $X_{\red} \to X$, we need a continuous map $\varphi : X \to X$ and a sheaf morphism $\varphi^{\#} : \cO_X \to {\left( \cO_X \right)}_{\red}$. We can pick $\varphi = \id_X$ and $\varphi^{\#}$ to be the composition $\cO_X \to {\left( \cO_X \right)}_{\red}^{\pre} \to {\left( \cO_X \right)}_{\red}$. This completes Part (b). 

    For Part (c), the fact that $\cO_X$ is reduced implies that the morphism $\cO_Y \to \cO_X$ can be factored through ${\left( \cO_Y \right)}_{\red}^{\pre}$. The rest follows from the universal property of the sheafification. 
\end{proof}

\begin{Exercise}\label{Exercise:2.2.4}
    Let $A$ be a ring and let $(X, \cO_X)$ be a scheme. Given a morphism $f : X \to \Spec A$, we have an associated map on sheaves $f^\# : \cO_{\Spec A} \to f_* \cO_X$. Taking global sections we obtain a homomorphism $A \to \Gamma(X, \cO_X)$. Thus there is a natural map 
    \[
        \alpha : \Hom_{\Sch}(X, \Spec A) \longrightarrow \Hom_{\Rings}(A, \Gamma(X, \cO_X)).
    \]
    Show that $\alpha$ is bijective. 
\end{Exercise}

\begin{proof}
    We begin with a ring homomorphism $\phi : A \to \Gamma(X, \cO_X)$. For any $p \in X$, we can consider the composition $\phi_p : A \to \Gamma(X, \cO_X) \to \cO_{X, p}$. This defines a set-map $f : X \to \Spec A$ defined by $f(p) \eqdef \phi_p^{-1}(\fm_{X, p})$. This is continuous because locally this is exactly the map when we restrict to affine open subschemes. For example, if we consider instead 
    \[
        A \to \Gamma(X, \cO_X) \to \Gamma(\Spec B, \cO_X|_{\Spec B}) \simeq B
    \]
    and then composition $A \to B \to B_{\fp}$ for $\fp \in \Spec B$ this is exactly our map $\Spec B \subseteq X \to \Spec A$ and corresponds exactly to the morphism $A \to B$. Since locally it is continuous, it must be continuous on $X \to \Spec A$. From the gluing and identity axiom on affine opens, we see that there exists a unique scheme morphism $X \to \Spec A$ corresponding to the ring morphism $A \to \Gamma(X, \cO_X)$. 
\end{proof}

\begin{Exercise}
    Describe $\Spec \ZZ$, and show that it is a final object in the category of schemes. 
\end{Exercise}

\begin{proof}
    The points of $\ZZ$ are $(0)$ and $(p)$ for primes $p \in \ZZ$. The zero ideal is the generic point. The ideals $(p)$ are closed points. The closed sets in the Zariski topology are the whole space, the empty set, and finite sets of points not containing $(0)$. The open sets are the whole space, the empty set, and infinite number of points including $(0)$. The sections over the whole space is $\ZZ$, the sections over the empty set is $0$, and the sections over the set ${\{(p_1), \ldots, (p_n)\}}^c$ is 
    \[
        \cO_{\Spec \ZZ} \left( \Spec \ZZ \backslash \{(p_1), \ldots, (p_n) \} \right) \simeq \ZZ \left[ \frac{1}{p_1}, \ldots, \frac{1}{p_n} \right]
    \]
    The fact that $\Spec \ZZ$ is a final object follows from Exercise~\ref{Exercise:2.2.4}. 
\end{proof}

\begin{Exercise}
    Describe the spectrum of the zero ring, and show that it is an initial object for the category of schemes. (According to our conventions, all ring homomorphisms must take 1 to 1. Since $0 = 1$ in the zero ring, we see that each ring $R$ admits a unique homomorphism to the zero ring, but that there is no homomorphism from the zero ring to $R$ unless $0 = 1$ in $R$.)
\end{Exercise}

\begin{proof}
    The spectrum of the zero ring is empty with sections $\cO(\emptyset) = 0$. Since any ring has a unique morphism to the $0$ ring, the spectrum of the zero ring is the initial object in the category of schemes. 
\end{proof}

\begin{Exercise}
    Let $X$ be a scheme. For any $x \in X$, let $\cO_x$ be the local ring at $x$, and $\fm_x$ its maximal ideal. We define the \textbf{residue field} of $x$ on $X$ to be the field $k(x) = \cO_x / \fm_x$. Now let $K$ be any field. Show that to give a morphism of $\Spec K$ to $X$ it is equivalent to give a point $x \in X$ and an inclusion map $k(x) \to K$. 
\end{Exercise}

\begin{proof}
    Let $(\phi, \phi^{\#}): \Spec K \to X$ be a morphism of schemes. Since $\Spec K$ consists of a single point, there is some $p \in X$ such that $\phi(\bullet) = p$. We then have a sheaf morphism 
    \[
        \phi^{\#} : \cO_X \to \phi_* \cO_{\Spec K}. 
    \]
    For $U \subseteq X$ not containing $p$, we have $\phi_* \cO_{\Spec K}(U) = 0$ so the map is uniquely determined. When $p \in U$, then we have $\phi^{\#} : \cO_X(U) \to K$. For all such $U$, it factors through $\cO_{X, p}$ by taking the induced map on stalks:
    \[
        \begin{tikzcd}
            {\mathscr{O}_X(U)} & K \\
            {\mathscr{O}_{X, p}} & K
            \arrow[from=1-1, to=1-2]
            \arrow[from=1-1, to=2-1]
            \arrow[Rightarrow, no head, from=1-2, to=2-2]
            \arrow[from=2-1, to=2-2]
        \end{tikzcd}
    \]
    Since the morphism is a morphism of local rings, it must be the case that the pre-image of the zero ideal in $K$ is $\fm_{X, x}$. Thus, this induces a map $k(x) \to k$ which must be an injection since homomorphisms between fields are always injections.
\end{proof}

\begin{Exercise}
    Let $X$ be a scheme. For any point $x \in X$, we define the \textbf{Zariski tangent space} $T_x$ to $X$ at $x$ to be the dual of the $k(x)$-vector space $\mathfrak{m}_x/\mathfrak{m}_x^2$. Now assume that $X$ is a scheme over a field $k$, and let $k[\varepsilon]/\varepsilon^2$ be the \textbf{ring of dual numbers} over $k$. Show that to give a $k$-morphism of $\operatorname{Spec} k[\varepsilon]/\varepsilon^2$ to $X$ is equivalent to giving a point $x \in X$, \textbf{rational over} $k$ (i.e., such that $k(x) = k$), and an element of $T_x$.
\end{Exercise}

\begin{proof}
    The dual numbers have only one prime ideal $(\varepsilon)$. To get a morphism $\Spec k[\varepsilon] / \varepsilon^2$ to $X$ on the topological level, we need to pick $x \in X$ for the single point to map to. Once we have this point, we need a morphism $\cO_{X, x} \to k[\varepsilon] / (\varepsilon^2)$. The maximal ideal must map into the maximal ideal. Hence, this induces a map $k(x) \to k$. But from the condition of being schemes over $\Spec(k)$, we have a composition $k \to k(x) \to k$ which is the identity. This proves that $x$ is rational over $k$. To pick the morphism $\cO_{X, x} \to k[\varepsilon] / (\varepsilon^2)$, first note that $\fm_x$ must map to $(\varepsilon)$ and since $\varepsilon^2 = 0$, we know that $\fm_x^2$ maps to $0$. Thus the locations of $\fm_x$ are determined by a linear map $\fm_x / \fm_x^2 \to (\varepsilon) \simeq k$. This gives us our element of $T_x$ and also determines the values of $\fm_x$ in the morphism $\cO_{X, x} \to k[\varepsilon] / (\varepsilon^2)$. The rest of the map comes from the $k$-scheme morphism and the fact that $k \to k(x) \to k$ is the identity. 
\end{proof}

\begin{Exercise}
    If $X$ is a topological space, and $Z$ can irreducible closed subset of $X$, a generic point for $Z$ is a point $\zeta$ such that $Z = \overline{\{\zeta\}}$. If $X$ is a scheme, show that every irreducible closed subset has a unique generic point. 
\end{Exercise}

\begin{proof}
    First suppose that $X$ is affine. Closed subsets are of the form $V(I)$ where $I$ is a radical ideal. I claim that $V(I)$ is irreducible if and only if $I$ is prime. If $I$ is prime, then it is irreducible because it is the closure of a single point. Now suppose $V(I)$ is irreducible. Suppose that $f, g \in A$ satisfy $fg \in I$. Then $V(I) = (V(I) \cap V(f)) \cup (V(I) \cap V(g))$ which implies that $V(f) \supseteq V(I)$ or $V(g) \supseteq V(I)$ which implies that $I$ is prime. This proves that all irreducible closed subsets are of the form $V(\fp)$. Clearly, the unique generic point in this case is $\fp$.

    Now let $X$ be a general scheme. Let $Z$ be an irreducible closed subset of $X$. Let $U$ be an affine open subset of $X$. Then $Z \cap U$ is an irreducible closed subset of $U$. From the previous paragrpah, there is a unique point $z \in Z \cap U$ such that the closure of $z$ in $U$ is $Z \cap U$. But this is an open set of $Z$ which is dense since $Z$ is irreducible. So the closure of $z$ in $X$ is the whole of $Z$. On the other hand, $Z$ has at most $1$ generic point. If it had two, if we intersect with an affine open, the affine open must contain both generic points. But we already proved that in affine open there is at most one generic point. This suffices for the proof. 
\end{proof}

\begin{Exercise}
    Describe $\RR[x]$. How does the topological space compare to $\RR$ or $\CC$? 
\end{Exercise}

\begin{proof}
    The points are $(0)$, $(x-a)$, and $(x^2 + k)$ for $k > 0$. 
\end{proof}

\begin{Exercise}
    Let $k = \FF_p$ be the finite field with $p$ elements. Describe $\Spec k[x]$. What are the residue fields of its points? How many points are there with a given residue field? 
\end{Exercise}

\begin{proof}
    The points of $\Spec k[x]$ are the prime ideals $(0)$ and $(f)$ where $f$ is an irreducible polynomial of $k[x]$. The prime ideal $(0)$ is the generic point and $(f)$ are closed points. The residue field at $(0)$ is $\FF_p(x)$ and the residue field at $(f)$ is $\FF_{p^{\deg f}}$. 
    
    To figure out the number of points with residue field $\FF_{p^d}$, we only need to count the number of monic irreducible polynoimals of degree $d$ in $\FF_p[x]$. To count this, we prove two facts:
    \begin{enumerate}
        \item An irreducible polynomial divides $x^{p^n} - x$ if and only if its degree divides $n$. 
        \item $x^{p^n} - x$ has distinct irreducible factors.
    \end{enumerate}
    Let $f$ be an irreducible polynomial of degree $d$ with $d | n$. Then $\FF_p[x] / (f) \simeq \FF_{p^d}$. Since $d | n$, any element in $\FF_{p^d}$ is a solution to $x^{p^n} - x = 0$. This implies that $x^{p^n} - x \in (f)$ which implies $f | x^{p^n} - x$. Conversely, suppose that $f$ is an irreducible polynomial dividing $x^{p^n} - x$. We already know that $f | x^{p^d} - x | x^{p^n} - x$ which proves (1). For (2), just take a derivative!
\end{proof}

\begin{Exercise}[Glueing Lemma]
    Let $\{X_i\}$ be a family of schemes (possibly infinite). For each $i \neq j$, suppose given an open subset $U_{ij} \subseteq X_i$, and let it have the induced scheme structure. Suppose also given for each $i \neq j$ an isomorphism of schemes $\varphi_{ij} : U_{ij} \to U_{ji}$ such that 
    \begin{enumerate}
        \item for each $i, j$, $\varphi_{ji} = \varphi_{ij}^{-1}$, and 
        \item for each $i, j, k$, $\varphi_{ij}(U_{ij} \cap U_{ik}) = U_{ji} \cap U_{jk}$, and $\varphi_{ik} = \varphi_{jk} \circ \varphi_{ij}$ on $U_{ij} \cap U_{ik}$.
    \end{enumerate}
    Then show that there is a scheme $X$, together with morphisms $\psi_i : X_i \to X$ for each $i$, such that 
    \begin{enumerate}
        \item $\psi_i$ is an isomorphism of $X_i$ onto an open subscheme of $X$, 
        \item the $\psi_i(X_i)$ cover $X$, 
        \item $\psi_i(U_{ij}) = \psi_i(X_i) \cap \psi_j(X_j)$, and 
        \item $\psi_i = \psi_j \circ \varphi_{ij}$ on $U_{ij}$. 
    \end{enumerate}
    We say that $X$ is obtained by \textbf{glueing} the schemes $X_i$ along the isomorphisms $\varphi_{ij}$.
\end{Exercise}

\begin{proof}
    We first describe the topological space $X$. Let $X = \bigsqcup X_i / \sim$ where $x_i \in X_i$ and $x_j \in X_j$ satisfy $x_i \sim x_j$ if and only if $x_i \in U_{ij}$, $x_j \in U_{ji}$, and $x_j = \varphi_{ij}(x_i)$. It is easy to see that this is an equivalence relation. 

    For every index $i$, we have a map $\ell_i : X_i \to X$ which is the natural inclusion $X_i \to \bigsqcup X_i$ and then projecting to $X$. We equip $X$ with the quotient topology. In this topology, $U \subseteq X$ is open if and only if $\ell_i^{-1}(U) \subseteq X_i$ is open for all $i$. To define the sheaf structure on $X$, we first define the notation of a family of compatible sections over $U \subseteq X$. 
    \begin{Definition}
        A \textbf{family of compatible sections} over $U \subseteq X$ is a family of sections $s_i \in \cO_{X_i} \left( \ell_i^{-1}(U) \right)$ such that for every $i \neq j$, we have 
        \[
            \varphi_{ij}^{\#} \left( s_j |_{\ell_j^{-1}(U) \cap U_{ji}} \right) = s_i|_{\ell_i^{-1}(U) \cap U_{ij}}
        \]
    \end{Definition}
    Now that we have defined families of compatible sections over open subsets of $X$, we can equip the $X$ with the presheaf of rings defined by
    \[
        \cO_X (U) \eqdef \left\{ \left( s_i \in \cO_{X_i}(\ell_i^{-1}(U)) \right) : \text{ family of compatible sections} \right\}.
    \]
    The restriction maps are component-wise restriction. The gluing axiom and identity axiom follow from the gluing and identity axiom of each $\cO_{X_i}$. Thus, we have realized $X$ as a ringed space.

    For every $i$, we have a natural morphism $\psi_i : \left( X_i, \cO_{X_i} \right) \to \left( X, \cO_X \right)$ where the continuous map $\psi_i : X_i \to X$ is the continuous map $\ell_i : X_i \to X$ and the morphism of sheaves 
    \begin{align*}
        \psi_i^{\#} & : \cO_X \to (\ell_i)_* \cO_{X_i} \\
        \psi_i^{\#}(U) & : \cO_X(U) \to \cO_{X_i}(\ell_i^{-1}(U))
    \end{align*}
    which is given by projection. It is clear that $\ell_i(X_i)$ is an open subset of $X$ and $\psi_i$ induces an isomorphism between $(X_i, \cO_{X_i})$ and $(\psi_i(X_i), \cO_X|_{\psi_i(X_i)})$. This proves that $X$ is a scheme.      
\end{proof}

\begin{Exercise}
    A topological space is \textbf{quasi-compact} if every open cover has a finite subcover. 
    \begin{enumerate}[label = (\alph*)]
        \item Show that a topological space is noetherian if and only if every open subset is quasi-compact. 
        \item If $X$ is an affine scheme, show that $\spce (X)$ is quasi-compact, but not in general noetherian. We say that a scheme is \textbf{quasi-compact} if $\spce(X)$ is. 
        \item If $A$ is a noetherian ring, show that $\spce (\Spec A)$ is a noetherian topological space. 
        \item Give an example where $\spce (\Spec A)$ can be noetherian even when $A$ is not. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    Suppose that $X$ is a noetherian topological space. This means that it satisfies the ascending chain condition on open sets. Let $U$ be an open set and consider an open cover $\{U_i\}$. If there is no finite subcover, we can find a strictly increasing sequence of open sets contained in $U$. But this contradicts the ascending chain condition. Conersely, suppose that every open set is quasi-compact. Take an ascending chain of open sets. Their union has a fintie subcover. This proves (a). 

    Let $X = \Spec A$. It suffices to prove that an open cover by distinguished open sets has a finite subcover. Suppose that 
    \[
        \Spec A = \bigcup D(f_i). 
    \]
    This means that any prime ideal of $A$ does not contain at least one $f_i$. Thus, the ideal $I = (f_i)$ is not contained in any prime ideal, which means $1 \in I$. So $1 = \sum c_i f_i$ for some finitely many $i$. Taking the corresponding $f_i$ we have our finite subcover. Affine schemes are not necessarily noetherian. Consider $A = k[x_1, x_2, \ldots]$ the polynomial ring with infinitely many variables. Then $\bigcup D(x_i)$ is an open set with no finite subcover. 

    Suppose that $A$ is noetherian. Now consider a descending chain of closed sets $Z(I_1) \supset Z(I_2) \supseteq \ldots$ where the $I_k$ are radical ideals. This corresponds to ascending chain of ideals $I_1 \subseteq I_2 \subseteq \ldots$ which is eventually stationary from noetherianness of $A$. This proves that $\spce(\Spec A)$ is noetherian. 

    For (d), consider $A = k[x_1, x_2, \ldots ] / (x_1^2, x_2^2, \ldots)$. Any prime ideal of $A$ must contain $x_1, x_2, \ldots$ since they are nilpotent. Thus the only prime ideal is $(x_1, x_2, \ldots)$. Hence $\spce(\Spec A)$ is automatically noetherian. But $A$ is not noetherian because $(x_1, x_2, \ldots)$ is not finitely generated. 


    \begin{Fact}
        $\Spec A$ is a noetherian topological space if and only if $A$ satisfies ascending chain condition for radical ideals. 
    \end{Fact}
\end{proof}

\begin{Exercise}
    \phantom{h}
    \begin{enumerate}[label = (\alph*)]
        \item Let $S$ be a graded ring. Show that $\Proj S = \emptyset$ if and only if every element of $S_+$ is nilpotent. 
        \item Let $\varphi : S \to T$ be a graded homomorphism of graded rings. Let $U = \{\fp \in \Proj T : \fp \not \supseteq \varphi(S_+)\}$. Show that $U$ is an open subset of $\Proj T$, and show that $\varphi$ determines a natural morphism $f : U \to \Proj S$.
        \item The morphism $f$ can be an isomorphism even when $\varphi$ is not. For example, suppose that $\varphi_d : S_d \to T_d$ is an isomorphism for all $d \geq d_0$, where $d_0$ is an integer. Then show that $U = \Proj T$ and the morphism $f : \Proj T \to \Proj S$ is an isomorphism. 
        \item Let $V$ be a projective variety with homogeneous coordinate ring $S$. Show that $t(V) \simeq \Proj S$. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    \phantom{h}
    \begin{enumerate}[label = (\alph*)]
        \item Suppose that every element of $S_+$ is nilpotent. Then $S_+$ is contained in every prime ideal and $\Proj S = \emptyset$. Conversely, suppose that $\Proj S = \emptyset$. Then any homogeneous prime ideal of $S$ contains $S_+$. The intersection of all homogeneous prime ideals is the nilradical (exercise for the reader). Hence every element in $S_+$ is nilpotent. 
        \item We have that  
        \[
            U^c = \left\{ \fp \in \Proj T : \fp \supseteq \varphi(S_+) \right\} = V(I)
        \]
        where $I$ is homogeneous ideal generated by $\varphi(S_d)$ for $d \geq 1$. This shows that $U$ is open. The natural morphism $f : U \to \Proj S$ takes some $\fp \in U$ and sends it to $\varphi^{-1}(\fp)$. This is a prime ideal not containing $S_+$. It is also homogeneous because it has grading 
        \[
            \varphi^{-1}(\fp) = \bigoplus_{d \geq 0} \varphi^{-1}(\fp_d). 
        \]
        This determines a set map $f : U \to \Proj S$. To prove continuity, let $\fa$ be a homogeneous ideal of $S$. The pre-image will consist of $V(\fb)$ where $\fb$ is the homogeneous ideal of $T$ generated by $\varphi(\fa_d)$ for all $d \geq 0$. This proves that $\varphi : U \to \Proj S$ is a continuous map. To define the sheaf morphism, it suffices to define it on a base. We want to define a (local) morphism of sheaves on $\Proj S$. 
        \[
            \cO_{\Proj S} \to f_* \left( \cO_{\Proj T} \Big|_U \right).
        \]
        We only need to define it on the base $D_+(f)$ where $f \in S_+$ is homogeneous and show that it behaves well under restriction. We have 
        \[
            S_{(f)} \simeq \cO_{\Proj S}(D_+(f)) \longrightarrow \cO_{\Proj T}(D_+(\varphi(f))) \simeq T_{(\varphi(f))}
        \]
        where the map is given by the standard localization map $S_f \to T_{\varphi(f)}$ and then taking the degree $0$ part. To prove that this is a morphism of locally ringed spaces, we want to show that for every point $\fp \in U$, the induced map 
        \[
            S_{(f(\fp))} \simeq \cO_{\Proj S, f(\fp)} \to \cO_{\Proj T, \fp} \simeq T_{(\fp)}
        \] 
        is a morphism of local rings. But this is clear. There are a few things we should check, for example that $S_{(\fp)}$ is actually a local ring! This was not shown in Hartshorne, but seems like a good exercise to show this fact. 

        \item Suppose that $\varphi : S_d \to T_d$ is an isomorphism for sufficiently large $d$. For any $\fp \in \Proj T$, there is some homogeneous $f \in T_+$ not contained in $\fp$. Since $\fp$ is prime, we can take high enough powers of $f$ to get that $\fp \not\supseteq T_d = \varphi(S_d)$ for $d$ sufficiently large. This implies that $U = \Proj T$. To prove that $f : \Proj T \to \Proj S$ is bijective, consider prime ideals $\fp_1, \fp_2 \in \Proj T$ where $\varphi^{-1}(\fp_1) = \varphi^{-1}(\fp_2)$ in $\Proj S$. Let $f \in \fp_1$. Then $f^d \in \fp_2$ for high enough power $d$. Since $\fp_2$ is prime, this implies $f \in \fp_2$. By symmetry, $\fp_1 = \fp_2$. This proves that $f$ is injective. To prove surjectivity, let $\{t_i\}$ be a family of homogeneous elements generating $T_+$. This means that $D_+(t_i)$ covers $T$. By raising the $t_i$ to sufficiently high powers, there exist $\{s_i\}$ in $S_+$ satisfying $\varphi(s_i) = t_i$ (since $D_+(t_i) = D_+(t_i^d)$). Then $D_+(t_i)$ gets mapped to $D_+(s_i)$ under the map. This also proves that the map is an open map! (Why?) The $D_+(s_i)$ cover $\Proj S$. Indeed, let $\fp \in \Proj S$ be arbitrary. If it contains all of the $s_i$, then $\varphi^{-1}(\fp)$ must contain all of the $t_i$. But this implies that $\varphi^{-1}(\fp)$ contains $T_+$, which is a contradiction. Thus the map is a bijective open map, which implies that it is a homeomorphism. To give the homeomorphism, we prove that the induced map on sheaves is bijective locally. On $D(s_i)$, it boils down to showing that 
        \[
            S_{(s_i)} \simeq T_{(t_i)}
        \]
        via the natural morphism $S_{(s_i)} \to T_{(t_i)}$. To prove injectivity, suppose that $\varphi(x/s_i^N) = \varphi(x)/t_i^N = 0$ in $T_{(t_i)}$. This implies that $t_i^M \varphi(x) = 0$ for some $M$ and taking sufficiently large $M$, we have $s_i^M x = 0$. This proves injectivity. To prove surjectivity, for $y/t_i^N$, we can take $M$ sufficiently large again and it is clear that 
        \[
            \frac{y}{t_i^N} = \frac{y t_i^M}{t_i^{M+N}} 
        \]
        is in the image. This suffices for the proof. 

        \item \textcolor{red}{I omit this.}
    \end{enumerate}
\end{proof}

\begin{Exercise}
    \phantom{h}
    \begin{enumerate}[label = (\alph*)]
        \item Let $V$ be a variety over the algebraically closed field $k$. Show that a point $p \in t(V)$ is a closed point if and only if its residue field is $k$. 
        \item If $f : X \to Y$ is a morphism of schemes over $k$, and if $p \in X$ is a point with residue field $k$, then $f(p) \in Y$ also has residue field $k$. 
        \item Now show that if $V, W$ are any two varieties over $k$, then the natural map 
        \[
            \Hom_{\Var}(V, W) \to \Hom_{\Sch / k} (t(V), t(W))
        \]
        is bijective. 
    \end{enumerate}
\end{Exercise}
\begin{proof}
    \textcolor{red}{Skipped. I don't quite understand the functor from varieties to schemes just yet in detail}
\end{proof}
\begin{Exercise}
    Let $X$ be a scheme, let $f \in \Gamma(X, \cO_X)$, and define $X_f$ to be the subset of points $x \in X$ such that the stalk $f_x$ of $f$ at $x$ is not contained in the maximal ideal $\fm_x$ of the local ring $\cO_x$. 
    \begin{enumerate}[label = (\alph*)]
        \item If $U = \Spec B$ is an open affine subscheme of $X$, and if $\bar{f} \in B = \Gamma(U, \cO_X|_U)$ is the restriction of $f$, show that $U \cap X_f = D(\bar{f})$. Conclude that $X_f$ is an open subset of $X$. 
        \item Assume that $X$ is quasi-compact. Let $A = \Gamma(X, \cO_X)$, and let $a \in A$ be an element whose restriction to $X_f$ is $0$. Show that for some $n > 0$, $f^n a = 0$. 
        \item Now assume that $X$ has a finite cover by open affines $U_i$ such that each intersection $U_i \cap U_j$ is quasi-compact. Let $b \in \Gamma(X_f, \cO_{X_f})$. Show that for some $n > 0$, $f^nb$ is the restriction of an element of $A$. 

        \item With the hypothesis of (c), conclude that $\Gamma(X_f, \cO_{X_f}) \simeq A_f$. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    For Part (a), it suffices to prove that for $f \in B$, then open set $D(f) \subseteq \Spec B$ can be characterized as the subset of primes $\fp \in \Spec B$ with $f \notin \fp B_\fp$. Thus, we want to prove that $f \in \fp$ in $B$ if and only if $f \in \fp B_\fp$ in $B_\fp$. One direction is easy. For the other direction, suppose $f \in \fp B_\fp$ in $B_\fp$. Then $f = x/y$ where $x \in \fp$ and $y \notin \fp$. Then $z(yf - x) = 0$ in $B$ for $z \notin \fp$. This implies that $f \in \fp$ in $B$ which suffices for the proof of (a). 

    For Part (b), it suffices to prove this when $X$ is affine because we can just pick the largest $n$ on a finite cover by affines (which exist since $X$ is quasi-compact). But the restriction of $a \in A$ being zero on $X_f$ implies that $a = 0$ in $A_f$. This exactly translates to $f^n a = 0$ for some $n$. This proves (b). 

    For Part (c), let $U_i = \Spec A_i$ be the finite affine open cover of $X$. Since $X_f \cap U_i = D_{A_i}(f)$, the section $b$ on $X_f \cap U_i$ comes from some $b_i \in \Gamma(U_i, \cO_{U_i})$ and 
    \[
        b |_{X_f \cap U_i} = \frac{b_i}{f^N}
    \]
    where we can pick $N$ to be large enough to hold for all affine opens in our finite cover. In particular, we have $f^N b |_{X_f \cap U_i} = b_i |_{X_f \cap U_i}$ for all $i$. It remains to glue together the $b_i \in \Gamma(U_i, \cO_{U_i})$. But this follows because on $U_i \cap U_j$, we can pick $M$ large enough so that $f^M(b_i - b_j) = 0$. We can pick $M$ large enough to hold for all finite pairs $i, j$. Thus $f^{M+N} b$ comes from a global section. 

    For Part (d), first consider the restriction map $A \to \Gamma(X_f, \cO_{X_f})$. To induce a map $A_f \to \Gamma(X_f, \cO_{X_f})$ we want to prove that $f|_{X_f}$ is invertible. Let $f_i \in \Gamma(U_i \cap X_f, \cO_{U_i \cap X_f})$ be an element on the affine open which is the inverse of $f|_{U_i \cap X-f}$. That is, we have $f|_{U_i \cap X_f} f_i = 1$ on $U_i \cap X_f$. To prove that we can glue the $f_i$ together, we look at $f_i - f_j$ on $U_i \cap U_j \cap X_f$ and prove that it is zero. But this follows because on stalks $f$ is invertible, which means that the stalk of $f_i - f_j$ is $0$ on all points in $U_i \cap U_j \cap X_f$. This implies that we have a well-defined map 
    \[
        A_f \longrightarrow \Gamma \left (X_f, \cO_{X_f} \right )
    \]
    From (b), we know that this is injective. This is surjective from (c). This suffices for the proof. 
\end{proof}

\begin{Exercise}\label{Exercise:2.2.17}
    \emph{A Criterion for Affineness}.
    \begin{enumerate}[label = (\alph*)]
        \item Let $f : X \to Y$ be a morphism of schemes, and suppose that $Y$ can be covered by open subsets $U_i$, such that for each $i$, the induced map $f^{-1}(U_i) \to U_i$ is an isomorphism. Then $f$ is an isomorphism. 
        \item A scheme $X$ is affine if and only if there is a finite set of elements 
        \[
            f_1, \ldots, f_r \in A = \Gamma(X, \cO_X),
        \] 
        such that the open subsets $X_{f_i}$ are affine, and $f_1, \ldots, f_r$ generate the unit ideal in $A$. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    We solve part (a). Since $f^{-1}(U_i) \to U_i$ is an isomorphism, on the level of topological spaces we have homeomorphisms $f^{-1}(U_i) \to U_i$. This implies that $f : X \to Y$ is a homeomorphism (standard topological fact). It remains to show that the map on sheaves 
    \[
        f^{\#} : \cO_Y \to f_* \cO_X
    \]
    is an isomorphism. We know that 
    \[
        f^{\#}|_{U_i} : \cO_Y|_{U_i} \to f_* \cO_X |_{U_i}
    \]
    is an isomorphism for all $U_i$. But this implies that the induced map on stalks are isomorphisms which implies that $f^{\#}$ is an isomorphism. This proves (a). 

    We solve part (b). If $X$ is affine, then we can let $f_1 = 1$ and this trivially generates all of $A$ while generating the unit ideal. Conversely, suppose that we have a finite set of elements $f_1, \ldots, f_r \in \Gamma(X, \cO_X)$ such that $X_{f_i}$ are affine and $1 = (f_1, \ldots, f_r)$. From the previous exercise, we know that $X_{f_i} \simeq \Spec A_{f_i}$. Since $f_i$ generate $A$, we know that the $X_{f_i}$ cover $X$. From exercise $4$, the canonical isomorphism $A \to \Gamma(X, \cO_X)$ gives us a natural scheme morphism $X \to \Spec A$. This maps $X_f$ to $D(f)$ and is an isomorphism (you can see this by reviewing the construction in Exercise 4). This implies that $X$ and $\Spec A$ are isomorphic. 
\end{proof}

\begin{Exercise}
    In this exercise, we compare some properties of a ring homomorphism to the induced morphism of the spectra of the rings. 
    \begin{enumerate}[label = (\alph*)]
        \item  Let $A$ be a ring, $X = \Spec A$, and $f \in A$. Show that $f$ is nilpotent if and only if $D(f)$ is empty. 
        \item Let $\varphi : A \to B$ be a homomorphism of rings, and let $f : Y = \Spec B \to X = \Spec A$ be the induced morphism of affine schemes. Show that $\varphi$ is injective if and only if the map of sheaves $f^\# : \cO_X \to f_* \cO_Y$ is injective. Show furthermore in that case $f$ is \emph{dominant}, i.e., $f(Y)$ is dense in $X$. 
        \item With the same notation, show that if $\varphi$ is surjective, then $f$ is a homeomorphism of $Y$ onto a closed subset of $X$, and $f^{\#} : \cO_X \to f_* \cO_Y$ is surjective. 
        \item Prove the converse to (c), namely, if $f : Y \to X$ is a homeomorphism onto a closed subset, and $f^{\#} : \cO_X \to f_* \cO_Y$ is surjective, then $\varphi$ is surjective. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    This problem has four parts. 
    \begin{enumerate}[label = (\alph*)]
        \item This part follows from the fact that the intersection of all prime ideals is exactly the nilpotent elements. 

        \item Suppose that $f^{\#} : \cO_X \to f_* \cO_Y$ is injective. Then the induced map on the global sections
        \[
            f^{\#} \left( \Spec A \right) : \Gamma(\Spec A, \cO_{\Spec A}) \to \Gamma(\Spec B, \cO_{\Spec B})
        \]
        is exactly our original ring homomorphism $\varphi : A \to B$. This implies that $\varphi$ is injective. 
        
        Conversely, suppose that $\varphi : A \to B$ is injective. To prove that $f^{\#} : \cO_X \to f_* \cO_Y$ is injective, it is enough to prove that it is injective on distinguished open sets of $\Spec A$. Consider an arbitrary $f \in A$. The induced map on sections of $D(f)$ becomes the localization map
        \[
            f^{\#}(D(f)) : A_f \simeq \cO_{\Spec A}(D(f)) \to \cO_{\Spec B}(D(\varphi(f))) \simeq B_{\varphi(f)}
        \]
        which is injective. To prove that $f : \Spec B \to \Spec A$ is dominant, let $D(f)$ be an open set not intersection $f(\Spec B)$. But then $\varphi(f)$ is contained in all prime ideal of $B$. This implies that $\varphi (f)$ is nilpotent. Since $\varphi$ is injective, we know that $f$ is nilpotent. So $D(f)$ is empty which suffices for the proof. 

        Alternatively, we can look at the stalk of $f^\# : \cO_{\Spec A} \to f_* \cO_{\Spec B}$. As we pointed out before, the induced map on $D(f)$ is 
        \[
            f^{\#}(D(f)) : A_f \simeq \cO_{\Spec A}{(D(f)} \to \cO_{\Spec B}(D(\varphi(f))) \simeq B_{\varphi(f)} \simeq B \otimes_A A_f
        \]
        where we view $B$ as an $A$-module via the morphism $\varphi : A \to B$. Since colimits commute with tensor products, the induced map on stalks is 
        \[
            f^{\#}_{\fp} : A \otimes_A A_\fp \to B \otimes_A A_\fp. 
        \] 
        Since localization of modules is an exact functor, the injectivity or surjectivity of $\varphi$ implies the injectivity or surjectivity of $f^\#$. 

        \item Since $\varphi$ is surjective, from the previous argument we know $f^{\#}$ is surjective. We only need to show that $f : \Spec B \to \Spec A$ is a closed embedding. We can assume that the ring homomorphism is of the form $A \to A/I$ where $I$ is an ideal. Then the map $f: \Spec (A/I) \to \Spec A$ is a homeomorphism on $V(I)$. Moreover, we have $V_{A/I}(\fp) = V_A(f(\fp))$ which proves that they are homeomorphic. 
        
        \item This follows from the previous observation about the induced map on stalks. The hypothesis that $f : Y \to X$ is a homeomorphism onto a closed subset is not needed. 
    \end{enumerate}
\end{proof}


\begin{Exercise}
    Let $A$ be a ring. Show that the following conditions are equivalent:
    \begin{enumerate}[label = (\roman*)]
        \item $\Spec A$ is disconnected; 
        \item there exist nonzero elements $e_1, e_2 \in A$ such that $e_1e_2 = 0$, $e_1^2 = e_1$, $e_2^2 = e_2$, and $e_1 + e_2 = 1$. (These elements are called orthogonal idempotents). 
        \item $A$ is isomorphic to a direct product $A_1 \times A_2$ of non-zero rings. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    Suppose $\Spec A$ is disconnected. Then we can write $\Spec A = V(I_1) \sqcup V(I_2)$ where $V(I_1)$ and $V(I_2)$ are clopen. Then 
    \begin{align*}
        A \simeq \cO_{\Spec A}(\Spec A) & \simeq \cO_{\Spec A} (V(I_1)) \times \cO_{\Spec A}(V(I_2)).
    \end{align*}
    This implies (iii). (iii) clearly implies (ii). (ii) clearly implies (iii) with the isomorphism $A \simeq e_1A \times e_2A$. (iii) clearly implies (i). This suffices for the proof. 
\end{proof}


\subsection{First Properties of Schemes}

\begin{Exercise}\label{Exercise:2.3.1}
    Show that a morphism $f : X \to Y$ is locally of finite type if and only if for \emph{every} affine open subset $V = \Spec B$ of $Y$, $f^{-1}(V)$ can be covered by open affine open subsets $U_j = \Spec A_j$, where each $A_j$ is a finitely generated $B$-algebra. 
\end{Exercise}

\begin{proof}
    The original definition for a morphism being locally of finite type is that there \emph{exists} a covering of $Y$ by affine open subsets whose preimages can be covered by affine open subsets where the corresponding ring are finitely generated as algebras. Clearly, if this holds for every affine open subset, then the morphism is locally of finite type. 

    To prove the other direction, we only need to prove the following two facts required in the application of the \textbf{affine communication lemma}. Let $P$ be the property of an affine open subsets $\Spec B \hookrightarrow Y$ that $f^{-1}(\Spec B)$ can be covered by affine open subsets $U_j = \Spec A_j$ where each $A_j$ is a finitely generated $B$-algebra. 
    \begin{enumerate}[label = (\roman*)]
        \item if $\Spec A \hookrightarrow Y$ has property $P$, then $\Spec A_f \hookrightarrow \Spec A \hookrightarrow Y$ has property $P$ for any $f \in A$. 
        \item if $(f_1, \ldots, f_n) = A$, and $\Spec A_{f_i} \hookrightarrow Y$ has property $P$ for all $i$, then $\Spec A \hookrightarrow Y$ has property $P$ too. 
    \end{enumerate}
    For (i), suppose that $\Spec A \hookrightarrow Y$ has property $P$. This means that we can cover the pre-image of $\Spec A$ with affine open subsets $\Spec B$ such that $\Spec B \to \Spec A$ is induced by $A \to B$ where $B$ is a finitely generated $A$-algebra. The subset $\Spec A_f \hookrightarrow \Spec A$ consists of the prime ideals avoiding $f$. The part of the pre-image in $\Spec B$ will then be $\Spec B_{\varphi(f)}$, the prime ideals of $B$ avoiding $\varphi(f)$. The induced map on affine schemes comes from the localization $A_f \to B_{\varphi(f)}$. Then $B_{\varphi(f)}$ is still finitely generated since we just add $1/\varphi(f)$ to our list of generators. This proves (i). 
    
    For (ii), let $(f_1, \ldots, f_n) = A$ so that $A = \bigcup D(f_i)$ and $\Spec A_{f_i}$ all have property $P$. But this is clear. The cover of the pre-images of $\Spec A_{f_i}$ will be a cover of the pre-image of $\Spec A$ by affine open subsets. Moreover, we have 
    \[
        \Spec B \to \Spec A_{f_i} \to \Spec A
    \]
    induced by $A \to A_{f_i} \to B$ where $B$ is a finitely generated $A_{f_i}$ algebra. But then $B$ would be a finitely generated $A$ algebra as well. 
    
\end{proof}

\begin{Exercise}\label{Exercise:2.3.2}
    A morphism $f : X \to Y$ of schemes is \textbf{quasi-compact} if there is a cover of $Y$ by open affines $V_i$ such that $f^{-1}(V_i)$ is quasi-compact for each $i$. Show that $f$ is quasi-compact if and only if for every open affine subset $V \subseteq Y$, $f^{-1}(V)$ is quasi-compact. 
\end{Exercise}

\begin{proof}
    Recall the two hypotheses of the affine communication lemma. 
    \begin{enumerate}[label = (\roman*)]
        \item if $\Spec A \hookrightarrow Y$ has property $P$, then $\Spec A_f \hookrightarrow \Spec A \hookrightarrow Y$ has property $P$ for any $f \in A$. 
        \item if $(f_1, \ldots, f_n) = A$, and $\Spec A_{f_i} \hookrightarrow Y$ has property $P$ for all $i$, then $\Spec A \hookrightarrow Y$ has property $P$ too. 
    \end{enumerate}
    For (i), since the pre-image of $\Spec A$ is quasi-compact, we can cover it with finitely many affine open subsets $\Spec B_i$. Each $\Spec B_i \to \Spec A$ is induced by some ring morphism $\varphi_i : A \to B_i$. The pre-image of $\Spec A_{f_i}$ in each affine open covering the pre-image will then be $\Spec \left( B_i \right)_{\varphi_i(f_i)}$. Since the pre-image of $\Spec A_{f_i}$ is covered by finitely many open affines, it is quasi-compact. 

    For (ii), this is clear because $\Spec A = \bigcup \Spec A_{f_i}$ and the union of a finite number of quasicompact sets is quasicompact. 
\end{proof}

\begin{Exercise}
    \phantom{h}
    \begin{enumerate}[label = (\alph*)]
        \item Show that a morphism $f : X \to Y$ is of finite type if and only if it is locally of finite type and quasi-compact. 
        \item Conclude from this that $f$ is of finite type if and only if for every open affine subset $V = \Spec B$ of $Y$, $f^{-1}(V)$ can be covered by a finite number of open affines $U_j  = \Spec A_j$, where each $A_j$ is a finitely generated $B$-algebra.
        \item Show that if $f$ is of finite type, then for every open affine subset $V = \Spec B \subseteq Y$, and for every open affine subset $U = \Spec A \subseteq f^{-1}(V)$, $A$ is a finitely generated $B$-algebra. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    Suppose that $f : X \to Y$ is locally of finite type and quasi-compact. Then from Exercise~\ref{Exercise:2.3.2} it must be of finite type. Now suppose that $f : X \to Y$ is of finite type. Then it is locally of finite type. Moreover it is quasi-compact since the cover in the definition of finite type has pre-images which are quasi-compact (as finite unions of affine schemes). This proves (a). 

    (b) follows from (a) and Exercise~\ref{Exercise:2.3.1} and Exercise~\ref{Exercise:2.3.2}. 

    We want to prove that if $f : X \to \Spec B$ is a morphism of finite type, then any affine open $\Spec A \hookrightarrow X$ is a finitely generated $B$-algebra. Let property $P$ be exactly this property. We want to prove the conditions of the affine communication lemma:
    \begin{enumerate}[label = (\roman*)]
        \item if $\Spec A \hookrightarrow Y$ has property $P$, then $\Spec A_f \hookrightarrow \Spec A \hookrightarrow Y$ has property $P$ for any $f \in A$. 
        \item if $(f_1, \ldots, f_n) = A$, and $\Spec A_{f_i} \hookrightarrow Y$ has property $P$ for all $i$, then $\Spec A \hookrightarrow Y$ has property $P$ too. 
    \end{enumerate}
    Part (i) follows from the fact that if $A$ is a finitely generated $B$ algebra, then $A_f$ will also be finitely generated by the finite generators and $1/f$. It is enough to prove the following algebra fact:
    \begin{Fact}
        Let $\varphi : B \to A$ be a ring morphism. Let $(f_1, \ldots, f_n) = A$ such that $A_{f_i}$ are finitely generated $B$-algebras. Then $A$ is a finitely generated $B$-algebra. 
    \end{Fact}
    \begin{proof}
        Pick $x_1, \ldots, x_m \in A$ such that $x_1, \ldots, x_m, 1/f_i$ generate $A_{f_i}$ as a $B$-algebra. Let $a_1, \ldots, a_n \in A$ such that $\sum a_i f_i = 1$. I claim that 
        \[
            x_1, \ldots, x_m, a_1, \ldots, a_n, f_1, \ldots, f_n
        \]
        generate $A$ as a $B$-algebra. For any $x \in A$, we can write 
        \[
            f_i^N x = P_i(x_1, \ldots, x_m, f_i)
        \]
        for some $P_i \in B[x_1, \ldots, x_{m+1}]$ for all $i$. By exponentiating $\sum a_i f_i = 1$ to the power of $N$, there are some $Q_i \in B[a_1, \ldots, a_m]$ such that $\sum Q_i f_i^N = 1$. This gives us the result. 
    \end{proof}
\end{proof}

\begin{Exercise}\label{Exercise:2.3.4}
    Show that a morphism $f : X \to Y$ is finite if and only if for every open affine subset $V = \Spec B$ of $Y$, $f^{-1}(V)$ is affine, equal to $\Spec A$, where $A$ is a finite $B$-module. 
\end{Exercise}

\begin{proof}
    It is clear from the definition of a finite morphism that if for every open affine subset $V = \Spec B$ of $Y$, $f^{-1}(V)$ is affine and equal to $\Spec A$, where $A$ is a finite $B$-module, then $f : X \to Y$ is a finite morphism. The other direction is the harder part. We will apply the affine communication lemma. 
    
    Let $P$ be the property of affine open subsets $\Spec A  \subseteq Y$ that the pre-image $\Spec B$ is affine and the map gives a finite module $A$ module structure to $B$. It suffices to prove the following two conditions in the affine communication lemma:
    \begin{enumerate}[label = (\roman*)]
        \item if $\Spec A \hookrightarrow Y$ has property $P$, then $\Spec A_f \hookrightarrow Y$ has property $P$ for any $f \in A$. 
        \item if $(f_1, \ldots, f_n) = A$, and $\Spec A_{f_i} \hookrightarrow Y$ has property $P$ for all $i$, then $\Spec A \hookrightarrow Y$ has property $P$ too. 
    \end{enumerate}
    Part (i) corresponds to the algebraic fact that if $\varphi : A \to B$ is finite, then $\varphi_f : A_f \to B_{\varphi(f)}$ is also finite. For Part (ii), it is enough to assume that our morphism is $\varphi : X \to \Spec A$, and the pre-images of $\Spec A_{f_i}$ are $\Spec B_i$. We want to prove that $X$ is affine and the induced map on global sections gives a finite module structure.
    
    To prove that $X$ is affine, we will use Exercise~\ref{Exercise:2.2.17}, the criterion for affineness. Consider the induced map on the global sections 
    \[
        \varphi^{\#} : A \simeq \cO_{\Spec A}\left ( \Spec A \right ) \longrightarrow \cO_X(X). 
    \]
    Then $\varphi^{\#}(f_i)$ generates the unit ideal in $\cO_X(X)$ since the $f_i$ generate the unit ideal in $A$. To complete the prove of affineness, it is enough to show that 
    \[  
        X_{\varphi^{\#}(f_i)} = \Spec B_i = \varphi^{-1}(\Spec A_{f_i}).
    \] 
    For any $x \in X$, we have a commutative diagram 
    \[
        \begin{tikzcd}
            A && {\mathscr{O}_X(X)} \\
            \\
            {\mathscr{O}_{\text{Spec } A, \varphi(x)}} && {\mathscr{O}_{X, x}}
            \arrow[from=1-1, to=1-3]
            \arrow[from=1-1, to=3-1]
            \arrow[from=1-3, to=3-3]
            \arrow[from=3-1, to=3-3]
        \end{tikzcd}
    \]
    where the bottom map is a morphism of local rings. Suppose that $x \in X_{\varphi^{\#}(f_i)}$. The tracking the trajectory of $f_i$ from the top left, horizontal, and then vertical we see that it does not land in the maximal ideal. But this implies that if we start from $f_i$ and then go vertical, it doesn't land in the maximal ideal of $\cO_{\Spec A, \varphi(x)}$. In other words, we have $\varphi(x) \in \Spec A_{f_i}$ or $x \in \varphi^{-1}(\Spec A_{f_i})$. Now, if $x \notin X_{\varphi^{\#}(f_i)}$, then by the same reasoning $f_i$ lands in the maximal ideal and we have $x \notin \varphi^{-1}(\Spec A_{f_i})$. This implies that $X_{\varphi^{\#}(f_i)} = \Spec B_i$ and its affine! This implies that $X$ is affine from Exercise~\ref{Exercise:2.2.17}. 

    Then the fact that this gives a finite module structure follows from Part (i). This suffices for the proof. 
\end{proof}

\begin{Exercise}
    A morphism $f : X \to Y$ is \textbf{quasi-finite} if for every point $y \in Y$, $f^{-1}(y)$ is a finite set. 
    \begin{enumerate}[label = (\alph*)]
        \item Show that a finite morphism is quasi-finite. 
        \item Show that a finite morphism is \textbf{closed}, i.e., the image of any closed subset is closed. 
        \item Show by example that a surjective, finite-type, quasi-finite morphism need not be finite. 
    \end{enumerate}
\end{Exercise}

\begin{proof}
    For part (a), it suffices to work over $f : \Spec B \to \Spec A$ where $B$ is a finite $A$-module. We want to prove that this map has finite fibers. 
\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    
% To add references to your document, replace the two \bib commands below. 
%
%         1. You can use a list of \bib commands for the items you reference as is
%         done in our toy example here.
%
%         2. A second option is to use the command 
%             \bibselect{yourltbfile}
%         to point to a file of \bib commands that should be named 
%         yourltbfile.ltb and be placed in the same folder as your LaTeX
%         source files. 
%
%         3. A third option is to use the command 
%             \bibliography{yourbibfile}
%         to point to a file of BibTeX \bib commands that should be named 
%         yourltbfile.bbl and be placed in the same folder as your LaTeX
%         source files. 
%   
% If you use option 3. above, you should comment out or delete the lines
%            \begin{bibdiv}
%                \begin{biblist}
%        before the \bib command below as well as the line
%                  \end{biblist}
%              \end{bibdiv}
%        after it. 
%
% If you use options 2. or 3. and wish to make your source file self-contained you may
%         for final submission, simply copy the \bib entries to your \LaTeX\ file and
%         wrap them, if necessary, as indicated above.
%  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibspread
\bibliographystyle{plain}
\bibliography{ref}

\vfill\eject
\end{document}